all: src qtmib.1 qtmib-discover.1 qtmib-report.1 qtmib-translate.1

datarootdir=@datarootdir@
PREFIX=@prefix@
prefix=@prefix@
VERSION=@PACKAGE_VERSION@
NAME=@PACKAGE_NAME@
PACKAGE_TARNAME=@PACKAGE_TARNAME@
DOCDIR=@docdir@

qtmib_prefix.h:
	echo "#define QTMIB_PREFIX \"$(PREFIX)\"" > qtmib_prefix.h

.PHONY: src
src: qtmib_prefix.h
	$(MAKE) -C $@ $(MFLAGS)


qtmib.1: src/man/qtmib.txt
	./mkman.sh $(VERSION) src/man/qtmib.txt qt6mib.1

qtmib-discover.1: src/man/qtmib-discover.txt
	./mkman.sh $(VERSION) src/man/qtmib-discover.txt qt6mib-discover.1

qtmib-report.1: src/man/qtmib-report.txt
	./mkman.sh $(VERSION) src/man/qtmib-report.txt qt6mib-report.1

qtmib-translate.1: src/man/qtmib-translate.txt
	./mkman.sh $(VERSION) src/man/qtmib-translate.txt qt6mib-translate.1



clean:;rm -f build/*; rm -f *.1 *.1.gz; make -C src clean

distclean: clean
	rm -f `find src/qtmib -name Makefile`
	rm -f `find src/qtmib -name .qmake.stash`
	rm -f `find src/discover -name Makefile`
	rm -f `find src/discover -name .qmake.stash`
	rm -f `find src/report -name Makefile`
	rm -f `find src/report -name .qmake.stash`
	rm -f qtmib_config.h Makefile config.status config.log qtmib_prefix.h
	rm -f  src/qtmib/config.log src/qtmib/config.status #fedora fix
	rm -fr autom4te.cache
	rm -f sanitizer.sh
	
install: all
	cd build; strip *; cd ..
	mkdir -p $(DESTDIR)/$(PREFIX)/bin
	mkdir -p $(DESTDIR)/$(PREFIX)/share/applications
	mkdir -p $(DESTDIR)/$(PREFIX)/share/pixmaps
	mkdir -p $(DESTDIR)/$(DOCDIR)
	mkdir -p $(DESTDIR)/$(PREFIX)/share/man/man1
	install -c -m 0755 build/qt6mib $(DESTDIR)/$(PREFIX)/bin/.
	install -c -m 0755 build/qt6mib-discover $(DESTDIR)/$(PREFIX)/bin/.
	install -c -m 0755 build/qt6mib-report $(DESTDIR)/$(PREFIX)/bin/.
	install -c -m 0755 build/qt6mib-translate $(DESTDIR)/$(PREFIX)/bin/.
	install -c -m 0644 src/qtmib/qt6mib.desktop $(DESTDIR)/$(PREFIX)/share/applications/.
	install -c -m 0644 src/qtmib/resources/qt6mib-128.png $(DESTDIR)/$(PREFIX)/share/pixmaps/qt6mib.png
	install -c -m 0644 COPYING $(DESTDIR)/$(DOCDIR)/.
	install -c -m 0644 README $(DESTDIR)/$(DOCDIR)/.
	install -c -m 0644 RELNOTES $(DESTDIR)/$(DOCDIR)/.
	rm -f qt6mib.1.gz
	gzip -9 qt6mib.1
	install -c -m 0644 qt6mib.1.gz $(DESTDIR)/$(PREFIX)/share/man/man1/.
	rm -f qt6mib-discover.1.gz
	gzip -9 qt6mib-discover.1
	install -c -m 0644 qt6mib-discover.1.gz $(DESTDIR)/$(PREFIX)/share/man/man1/.
	rm -f qt6mib-report.1.gz
	gzip -9 qt6mib-report.1
	install -c -m 0644 qt6mib-report.1.gz $(DESTDIR)/$(PREFIX)/share/man/man1/.
	rm -f qt6mib-translate.1.gz
	gzip -9 qt6mib-translate.1
	install -c -m 0644 qt6mib-translate.1.gz $(DESTDIR)/$(PREFIX)/share/man/man1/.

uninstall:;
	rm -f $(DESTDIR)/$(PREFIX)/bin/qt6mib
	rm -f $(DESTDIR)/$(PREFIX)/bin/qt6mib-discover
	rm -f $(DESTDIR)/$(PREFIX)/bin/qt6mib-report
	rm -f $(DESTDIR)/$(PREFIX)/bin/qt6mib-translate
	rm -f $(DESTDIR)/$(PREFIX)/share/pixmaps/qt6mib.png
	rm -f $(DESTDIR)/$(PREFIX)/share/applications/qt6mib.desktop
	rm -fr $(DESTDIR)/$(PREFIX)/share/doc/qt6mib
	rm -fr $(DESTDIR)/$(PREFIX)/share/man/man1/qt6mib.1*
	rm -fr $(DESTDIR)/$(PREFIX)/share/man/man1/qt6mib-discover.1*
	rm -fr $(DESTDIR)/$(PREFIX)/share/man/man1/qt6mib-report.1*
	rm -fr $(DESTDIR)/$(PREFIX)/share/man/man1/qt6mib-translate.1*

dist: distclean
	./mkdist.sh $(NAME) $(VERSION)

deb: dist
	./mkdeb.sh $(NAME) $(VERSION)

	
	
